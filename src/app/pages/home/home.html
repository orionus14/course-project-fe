<div class="max-w-content mx-auto p-4 sm:p-6 md:p-8">
    <!-- Header with logo and user info -->
    <div class="header-section mb-8">
        <div class="flex flex-col sm:flex-row justify-between items-center gap-4 mb-4">
            <div class="logo-section">
                <h1 class="text-3xl font-bold text-primary-color flex items-center gap-3">
                    üéôÔ∏è Voice Recorder
                </h1>
            </div>
            <div class="user-controls flex items-center gap-4">
                @if(currentUser) {
                <div class="user-welcome text-dark-gray">
                    <span class="font-medium">–í—ñ—Ç–∞—î–º–æ, {{ currentUser.name || currentUser.email }}!</span>
                </div>
                }
                <button (click)="logout()"
                    class="bg-primary-color text-white py-3 px-6 rounded-xl shadow-light-orange hover:opacity-90 transition">
                    üîí –í–∏–π—Ç–∏
                </button>
            </div>
        </div>
        <div class="border-b-2 border-secondary-color"></div>
    </div>

    <div class="voice-assistant-container bg-light-gray p-6 rounded-2xl shadow-light-gray">
        <h2 class="text-2xl font-semibold mb-6 text-dark-gray">–ì–æ–ª–æ—Å–æ–≤–∏–π –ø–æ–º—ñ—á–Ω–∏–∫</h2>

        <!-- –í–∏–±—ñ—Ä —Å–ø–æ—Å–æ–±—É –≤–≤–µ–¥–µ–Ω–Ω—è -->
        <div class="input-method flex flex-col sm:flex-row sm:gap-6 mb-6">
            <label class="flex items-center gap-2 cursor-pointer">
                <input type="radio" name="inputMethod" value="record" [(ngModel)]="inputMethod"
                    (change)="onInputMethodChange()" class="form-radio cursor-pointer">
                üé§ –ó–∞–ø–∏—Å –∑ –º—ñ–∫—Ä–æ—Ñ–æ–Ω—É
            </label>
            <label class="flex items-center gap-2 cursor-pointer">
                <input type="radio" name="inputMethod" value="upload" [(ngModel)]="inputMethod"
                    (change)="onInputMethodChange()" class="form-radio cursor-pointer">
                üìÅ –ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ —Ñ–∞–π–ª
            </label>
        </div>

        <!-- –í–∏–±—ñ—Ä –¥–≤–∏–∂–∫–∞ -->
        <div class="engine-selection flex flex-col sm:flex-row sm:gap-6 mb-6">
            <label class="flex items-center gap-2 cursor-pointer">
                <input type="radio" name="engine" value="whisper" [(ngModel)]="engine"
                    class="form-radio cursor-pointer">
                Whisper (EN)
            </label>
            <label class="flex items-center gap-2 cursor-pointer">
                <input type="radio" name="engine" value="custom" [(ngModel)]="engine" class="form-radio cursor-pointer">
                –í–ª–∞—Å–Ω–∞ ASR (UA)
            </label>
        </div>

        <!-- –ó–∞–ø–∏—Å –∑ –º—ñ–∫—Ä–æ—Ñ–æ–Ω—É -->
        @if(inputMethod === 'record') {
        <div class="recording-controls flex flex-col gap-4 mb-6">
            <div class="flex flex-col sm:flex-row sm:items-center gap-4">
                <button (click)="startRecording()" [disabled]="recording || loading || recordedAudioUrl"
                    class="h-14 px-6 bg-primary-color text-white rounded-xl shadow-light-orange hover:opacity-90 transition disabled:opacity-50 disabled:cursor-not-allowed">
                    üé§ –ü–æ—á–∞—Ç–∏ –∑–∞–ø–∏—Å
                </button>
                <button (click)="stopRecording()" [disabled]="!recording || loading"
                    class="h-14 px-6 bg-secondary-color text-dark-gray rounded-xl shadow-light-yellow hover:opacity-90 transition disabled:opacity-50 disabled:cursor-not-allowed">
                    ‚èπÔ∏è –ó—É–ø–∏–Ω–∏—Ç–∏
                </button>
                @if(recording) {
                <span class="text-primary-color font-semibold ml-2 animate-pulse">‚óè –ó–∞–ø–∏—Å...</span>
                }
            </div>

            <!-- –ü–æ–ø–µ—Ä–µ–¥–Ω—î –ø—Ä–æ—Å–ª—É—Ö–æ–≤—É–≤–∞–Ω–Ω—è –∑–∞–ø–∏—Å—É -->
            @if(recordedAudioUrl && !recording) {
            <div class="preview-section p-4 bg-white rounded-xl shadow-light-gray">
                <h3 class="text-lg font-semibold text-dark-gray mb-3">–ü–æ–ø–µ—Ä–µ–¥–Ω—î –ø—Ä–æ—Å–ª—É—Ö–æ–≤—É–≤–∞–Ω–Ω—è:</h3>
                <audio [src]="recordedAudioUrl" controls class="w-full mb-4"></audio>
                <div class="flex flex-wrap gap-3">
                    <button (click)="confirmAndSendRecording()" [disabled]="loading"
                        class="px-6 py-3 bg-primary-color text-white rounded-xl shadow-light-orange hover:opacity-90 transition disabled:opacity-50">
                        ‚úÖ –ü—ñ–¥—Ç–≤–µ—Ä–¥–∏—Ç–∏ —Ç–∞ —Ä–æ–∑–ø—ñ–∑–Ω–∞—Ç–∏
                    </button>
                    <button (click)="discardRecording()"
                        class="px-6 py-3 bg-error-message text-white rounded-xl shadow-light-orange hover:opacity-90 transition">
                        ‚ùå –í—ñ–¥—Ö–∏–ª–∏—Ç–∏ —Ç–∞ –∑–∞–ø–∏—Å–∞—Ç–∏ –∑–∞–Ω–æ–≤–æ
                    </button>
                </div>
            </div>
            }
        </div>
        }

        <!-- –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Ñ–∞–π–ª—É -->
        @if(inputMethod === 'upload') {
        <div class="upload-controls flex flex-col gap-4 mb-6">
            <div class="flex flex-col sm:flex-row sm:items-center gap-4">
                <input type="file" accept="audio/*" (change)="onFileSelected($event)" #fileInput
                    class="h-14 w-full sm:w-72 rounded-xl border border-border-gray px-4 shadow-light-gray">
                <button (click)="uploadFile()" [disabled]="!selectedFile || loading"
                    class="h-14 px-6 bg-primary-color text-white rounded-xl shadow-light-orange hover:opacity-90 transition disabled:opacity-50 disabled:cursor-not-allowed">
                    üì§ –ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ —Ç–∞ —Ä–æ–∑–ø—ñ–∑–Ω–∞—Ç–∏
                </button>
                @if(selectedFile) {
                <button (click)="clearSelectedFile()"
                    class="h-14 px-6 bg-error-message text-white rounded-xl shadow-light-orange hover:opacity-90 transition">
                    ‚ùå –û—á–∏—Å—Ç–∏—Ç–∏
                </button>
                }
            </div>
            @if(selectedFile) {
            <div class="selected-file-info mb-4 p-3 bg-white rounded-lg">
                <p class="text-sm text-dark-gray">–û–±—Ä–∞–Ω–∏–π —Ñ–∞–π–ª: <strong>{{ selectedFile.name }}</strong></p>
            </div>
            }
        </div>
        }

        <!-- –ß–µ–∫–±–æ–∫—Å –¥–ª—è –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è –∞—É–¥—ñ–æ -->
        <div class="save-option mb-6">
            <label class="flex items-center gap-2 cursor-pointer">
                <input type="checkbox" [(ngModel)]="saveAudio" class="form-checkbox cursor-pointer">
                –ó–±–µ—Ä–µ–≥—Ç–∏ –∞—É–¥—ñ–æ —Ñ–∞–π–ª
            </label>
        </div>

        <!-- –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è -->
        @if(loading) {
        <div class="loading mb-6 p-4 bg-secondary-color rounded-xl">
            <p class="text-dark-gray font-medium flex items-center gap-2">
                <span class="animate-spin">‚è≥</span> –û–±—Ä–æ–±–∫–∞...
            </p>
        </div>
        }

        <!-- –†–µ–∑—É–ª—å—Ç–∞—Ç —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü—ñ—ó –∑ –º–æ–∂–ª–∏–≤—ñ—Å—Ç—é —Ä–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è -->
        @if(transcript && !loading) {
        <div class="transcript-result mb-6 p-4 bg-white rounded-xl shadow-light-gray">
            <h3 class="text-lg font-semibold text-dark-gray mb-2">–†–æ–∑–ø—ñ–∑–Ω–∞–Ω–∏–π —Ç–µ–∫—Å—Ç:</h3>

            @if(isEditingTranscript) {
            <textarea [(ngModel)]="transcript"
                class="w-full p-3 border border-border-gray rounded-lg mb-3 min-h-32 text-dark-gray"
                placeholder="–†–µ–¥–∞–≥—É–π—Ç–µ —Ç–µ–∫—Å—Ç..."></textarea>
            } @else {
            <p class="text-dark-gray mb-3 whitespace-pre-wrap">{{ transcript }}</p>
            }

            @if(language) {
            <small class="text-medium-gray block mb-3">–ú–æ–≤–∞: {{ language }}</small>
            }

            <div class="flex flex-wrap gap-3">
                <button (click)="toggleEditTranscript()"
                    class="px-4 py-2 bg-secondary-color text-dark-gray rounded-xl shadow-light-yellow hover:opacity-90 transition">
                    {{ isEditingTranscript ? 'üíæ –ó–±–µ—Ä–µ–≥—Ç–∏ –∑–º—ñ–Ω–∏' : '‚úèÔ∏è –†–µ–¥–∞–≥—É–≤–∞—Ç–∏' }}
                </button>
                <button (click)="copyTranscript()"
                    class="px-4 py-2 bg-primary-color text-white rounded-xl shadow-light-orange hover:opacity-90 transition">
                    üìã –°–∫–æ–ø—ñ—é–≤–∞—Ç–∏
                </button>
                @if(copySuccess) {
                <span class="text-primary-color font-medium flex items-center">‚úì –°–∫–æ–ø—ñ–π–æ–≤–∞–Ω–æ!</span>
                }
            </div>
        </div>
        }

        <!-- –Ü—Å—Ç–æ—Ä—ñ—è –∑–∞–ø–∏—Å—ñ–≤ -->
        <div class="records-history mt-6">
            <button (click)="toggleRecords()"
                class="mb-4 h-12 px-6 bg-secondary-color text-dark-gray rounded-xl shadow-light-yellow hover:opacity-90 transition">
                {{ showRecords ? 'üîº' : 'üîΩ' }} {{ showRecords ? '–°—Ö–æ–≤–∞—Ç–∏' : '–ü–æ–∫–∞–∑–∞—Ç–∏' }} —ñ—Å—Ç–æ—Ä—ñ—é –∑–∞–ø–∏—Å—ñ–≤
            </button>

            @if(showRecords) {
            <div class="flex flex-col gap-4 max-h-96 overflow-y-auto">
                <button (click)="loadRecords()" [disabled]="loading"
                    class="mb-2 h-12 px-6 bg-secondary-color text-dark-gray rounded-xl shadow-light-yellow hover:opacity-90 transition disabled:opacity-50 disabled:cursor-not-allowed">
                    üîÑ –û–Ω–æ–≤–∏—Ç–∏
                </button>

                @if(records.length > 0) {
                <div class="records-list flex flex-col gap-4">
                    @for(record of records; track record.id) {
                    <div
                        class="record-item flex flex-col sm:flex-row sm:justify-between items-start sm:items-center p-4 bg-white rounded-xl shadow-light-gray">
                        <div class="record-content mb-2 sm:mb-0 flex-1">
                            <p class="record-text text-dark-gray">{{ record.text }}</p>
                            <small class="text-medium-gray">{{ record.created_at | date:'short' }} | {{ record.engine
                                }}</small>
                        </div>
                        <div class="record-actions flex gap-2">
                            <button (click)="copyRecordText(record.text)"
                                class="px-4 py-2 bg-secondary-color text-dark-gray rounded-xl shadow-light-yellow hover:opacity-90 transition">
                                üìã
                            </button>
                            @if(record.audio_filename) {
                            <button (click)="playAudio(record.audio_filename)"
                                class="px-4 py-2 bg-primary-color text-white rounded-xl shadow-light-orange hover:opacity-90 transition">
                                ‚ñ∂Ô∏è
                            </button>
                            }
                            <button (click)="deleteRecord(record.id)"
                                class="px-4 py-2 bg-error-message text-white rounded-xl shadow-light-orange hover:opacity-90 transition">
                                üóëÔ∏è
                            </button>
                        </div>
                    </div>
                    }
                </div>
                } @else {
                <p class="no-records text-medium-gray text-center p-4">–ù–µ–º–∞—î –∑–∞–ø–∏—Å—ñ–≤</p>
                }
            </div>
            }
        </div>
    </div>
</div>